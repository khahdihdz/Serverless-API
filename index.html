<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theo d√µi th·ªùi ti·∫øt</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5f6fa;
        }

        body {
            background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
            min-height: 100vh;
        }

        .weather-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: transform 0.3s ease;
        }

        .weather-card:hover {
            transform: translateY(-5px);
        }

        .weather-icon {
            width: 100px;
            height: 100px;
        }

        .temperature {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .details-card {
            background: var(--secondary-color);
            border-radius: 15px;
            padding: 15px;
        }

        .notification-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .forecast-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="text-center mb-4">Theo d√µi th·ªùi ti·∫øt khu v·ª±c</h1>
                <div class="d-flex justify-content-center mb-3">
                    <div class="input-group w-50">
                        <input type="text" id="location" class="form-control" placeholder="Nh·∫≠p t√™n th√†nh ph·ªë">
                        <button class="btn btn-primary" onclick="updateLocation()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="weather-card p-4">
                    <div class="text-center">
                        <img id="weather-icon" class="weather-icon mb-3" src="/api/placeholder/100/100" alt="Weather Icon">
                        <h2 id="location-name" class="mb-3">ƒêang t·∫£i...</h2>
                        <div class="temperature" id="temperature">--¬∞C</div>
                        <p class="description mb-0" id="description">-</p>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="weather-card p-4">
                    <h3 class="mb-4">Chi ti·∫øt th·ªùi ti·∫øt</h3>
                    <div class="row">
                        <div class="col-6 mb-3">
                            <div class="details-card">
                                <i class="fas fa-tint mb-2"></i>
                                <h5>ƒê·ªô ·∫©m</h5>
                                <p id="humidity" class="mb-0">--%</p>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="details-card">
                                <i class="fas fa-wind mb-2"></i>
                                <h5>T·ªëc ƒë·ªô gi√≥</h5>
                                <p id="wind-speed" class="mb-0">-- m/s</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="details-card">
                                <i class="fas fa-compress-arrows-alt mb-2"></i>
                                <h5>√Åp su·∫•t</h5>
                                <p id="pressure" class="mb-0">-- hPa</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="details-card">
                                <i class="fas fa-eye mb-2"></i>
                                <h5>T·∫ßm nh√¨n</h5>
                                <p id="visibility" class="mb-0">-- km</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="details-card">
                                <i class="fas fa-cloud-rain mb-2"></i>
                                <h5>T·ª∑ l·ªá m∆∞a</h5>
                                <p id="rain" class="mb-0">--%</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="details-card">
                                <i class="fas fa-snowflake mb-2"></i>
                                <h5>T·ª∑ l·ªá tuy·∫øt</h5>
                                <p id="snow" class="mb-0">--%</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12">
                <h3 class="mb-4">D·ª± b√°o th·ªùi ti·∫øt 5 ng√†y</h3>
                <div id="forecast" class="row"></div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="weather-card p-4">
                    <h3 class="mb-4">C√†i ƒë·∫∑t th√¥ng b√°o Telegram</h3>
                    <div class="mb-3">
                        <label for="bot-token" class="form-label">Bot Token</label>
                        <input type="text" class="form-control" id="bot-token" placeholder="Nh·∫≠p Bot Token">
                    </div>
                    <div class="mb-3">
                        <label for="chat-id" class="form-label">Chat ID</label>
                        <input type="text" class="form-control" id="chat-id" placeholder="Nh·∫≠p Chat ID">
                    </div>
                    <button class="btn btn-primary" onclick="saveNotificationSettings()">
                        L∆∞u c√†i ƒë·∫∑t
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="notification-status" id="notification-status"></div>

    <script>
        const OPENWEATHER_API_KEY = 'YOUR_API_KEY_HERE'; // Thay b·∫±ng API key c·ªßa b·∫°n
        let currentCity = 'Hanoi';
        let telegramSettings = {
            botToken: '',
            chatId: ''
        };

        // Load saved settings
        document.addEventListener('DOMContentLoaded', () => {
            const savedSettings = localStorage.getItem('telegramSettings');
            if (savedSettings) {
                telegramSettings = JSON.parse(savedSettings);
                document.getElementById('bot-token').value = telegramSettings.botToken;
                document.getElementById('chat-id').value = telegramSettings.chatId;
            }
            
            const savedCity = localStorage.getItem('currentCity');
            if (savedCity) {
                currentCity = savedCity;
                document.getElementById('location').value = currentCity;
            }
            
            updateWeather();
        });

        function updateLocation() {
            const newLocation = document.getElementById('location').value;
            if (newLocation) {
                currentCity = newLocation;
                localStorage.setItem('currentCity', currentCity);
                updateWeather();
            }
        }

        async function updateWeather() {
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${currentCity}&appid=${OPENWEATHER_API_KEY}&units=metric&lang=vi`);
                const data = await response.json();

                if (data.cod === 200) {
                    document.getElementById('location-name').textContent = data.name;
                    document.getElementById('temperature').textContent = `${Math.round(data.main.temp)}¬∞C`;
                    document.getElementById('description').textContent = data .weather[0].description;
                    document.getElementById('humidity').textContent = `${data.main.humidity}%`;
                    document.getElementById('wind-speed').textContent = `${data.wind.speed} m/s`;
                    document.getElementById('pressure').textContent = `${data.main.pressure} hPa`;
                    document.getElementById('visibility').textContent = `${(data.visibility / 1000).toFixed(1)} km`;
                    document.getElementById('weather-icon').src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;

                    // C·∫≠p nh·∫≠t t·ª∑ l·ªá m∆∞a v√† tuy·∫øt
                    document.getElementById('rain').textContent = data.rain ? `${data.rain['1h'] || 0}%` : '0%';
                    document.getElementById('snow').textContent = data.snow ? `${data.snow['1h'] || 0}%` : '0%';

                    // G·ª≠i th√¥ng b√°o n·∫øu ƒë√£ c·∫•u h√¨nh
                    if (telegramSettings.botToken && telegramSettings.chatId) {
                        sendTelegramNotification(data);
                    }

                    // C·∫≠p nh·∫≠t d·ª± b√°o th·ªùi ti·∫øt 5 ng√†y
                    updateForecast();
                } else {
                    showNotification('Kh√¥ng t√¨m th·∫•y ƒë·ªãa ƒëi·ªÉm', 'danger');
                }
            } catch (error) {
                console.error('Error fetching weather data:', error);
                showNotification('L·ªói khi c·∫≠p nh·∫≠t th·ªùi ti·∫øt', 'danger');
            }
        }

        async function updateForecast() {
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${currentCity}&appid=${OPENWEATHER_API_KEY}&units=metric&lang=vi`);
                const data = await response.json();

                if (data.cod === "200") {
                    const forecastContainer = document.getElementById('forecast');
                    forecastContainer.innerHTML = ''; // X√≥a n·ªôi dung c≈©

                    // L·∫∑p qua c√°c d·ª± b√°o v√† hi·ªÉn th·ªã
                    for (let i = 0; i < data.list.length; i += 8) { // M·ªói 8 gi·ªù
                        const forecast = data.list[i];
                        const date = new Date(forecast.dt * 1000);
                        const day = date.toLocaleDateString('vi-VN', { weekday: 'long' });
                        const temp = Math.round(forecast.main.temp);
                        const description = forecast.weather[0].description;
                        const icon = forecast.weather[0].icon;

                        const forecastCard = `
                            <div class="col-md-2 mb-3">
                                <div class="forecast-card">
                                    <h5>${day}</h5>
                                    <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="Weather Icon">
                                    <p>${temp}¬∞C</p>
                                    <p>${description}</p>
                                </div>
                            </div>
                        `;
                        forecastContainer.innerHTML += forecastCard;
                    }
                } else {
                    showNotification('Kh√¥ng t√¨m th·∫•y d·ª± b√°o th·ªùi ti·∫øt', 'danger');
                }
            } catch (error) {
                console.error('Error fetching forecast data:', error);
                showNotification('L·ªói khi c·∫≠p nh·∫≠t d·ª± b√°o th·ªùi ti·∫øt', 'danger');
            }
        }

        function saveNotificationSettings() {
            const botToken = document.getElementById('bot-token').value;
            const chatId = document.getElementById('chat-id').value;

            if (botToken && chatId) {
                telegramSettings = { botToken, chatId };
                localStorage.setItem('telegramSettings', JSON.stringify(telegramSettings));
                showNotification('ƒê√£ l∆∞u c√†i ƒë·∫∑t th√¥ng b√°o', 'success');
            } else {
                showNotification('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin', 'warning');
            }
        }

        async function sendTelegramNotification(weatherData) {
            const message = `
üå°Ô∏è Th·ªùi ti·∫øt t·∫°i ${weatherData.name}:
- Nhi·ªát ƒë·ªô: ${Math.round(weatherData.main.temp)}¬∞C
- Th·ªùi ti·∫øt: ${weatherData.weather[0].description}
- ƒê·ªô ·∫©m: ${weatherData.main.humidity}%
- Gi√≥: ${weatherData.wind.speed} m/s
- √Åp su·∫•t: ${weatherData.main.pressure} hPa
- T·∫ßm nh√¨n: ${(weatherData.visibility / 1000).toFixed(1)} km
- T·ª∑ l·ªá m∆∞a: ${weatherData.rain ? `${weatherData.rain['1h'] || 0}%` : '0%'}
- T·ª∑ l·ªá tuy·∫øt: ${weatherData.snow ? `${weatherData.snow['1h'] || 0}%` : '0%'}

‚è∞ C·∫≠p nh·∫≠t: ${new Date().toLocaleString('vi-VN')}
            `;

            try {
                const response = await fetch(`https://api.telegram.org/bot${telegramSettings.botToken}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: telegramSettings.chatId,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });

                const data = await response.json();
                if (!data.ok) {
                    throw new Error('Failed to send Telegram notification');
                }
            } catch (error) {
                console.error('Error sending Telegram notification:', error);
                showNotification('L·ªói khi g·ª≠i th√¥ng b√°o Telegram', 'danger');
            }
        }

        function showNotification(message, type) {
            const notificationElement = document.getElementById('notification-status');
            notificationElement.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            `;
            setTimeout(() => {
                const alert = notificationElement.querySelector('.alert');
                if (alert) {
                    alert.remove();
                }
            }, 5000);
        }

        // Update weather every 10 minutes
        setInterval(updateWeather, 600000);
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
</body>
</html>
