<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hack Fit - Fake Steps</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="styles.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body class="bg-light">

<div class="container text-center mt-5">
    <h2 class="text-primary">ğŸƒ Hack Google Fit Steps ğŸƒ</h2>
    <p class="text-secondary">Fake bÆ°á»›c chÃ¢n vÃ  kiá»ƒm tra dá»¯ liá»‡u dá»… dÃ ng!</p>

    <button id="loginBtn" class="btn btn-danger mt-3">ğŸ”“ ÄÄƒng nháº­p Google Fit</button>
    
    <div class="mt-3">
        <label for="stepsInput" class="form-label">ğŸ”¢ Nháº­p sá»‘ bÆ°á»›c chÃ¢n:</label>
        <input type="number" id="stepsInput" class="form-control w-50 mx-auto" min="0" value="10000">
        <button onclick="fakeSteps()" class="btn btn-success mt-2">ğŸš€ Ghi bÆ°á»›c chÃ¢n</button>
    </div>

    <div class="mt-3">
        <button onclick="checkSteps()" class="btn btn-info">ğŸ“Š Kiá»ƒm tra bÆ°á»›c chÃ¢n</button>
        <p id="status" class="mt-2 text-primary">â³ Chá» káº¿t quáº£...</p>
    </div>
</div>

<script>
    const CLIENT_ID = "422012132533-pgroo786kqrbdq8aj1b791erm4aic29l.apps.googleusercontent.com";
    const SCOPES = "https://www.googleapis.com/auth/fitness.activity.write https://www.googleapis.com/auth/fitness.activity.read";
    let accessToken = "";

    function loginGoogle() {
        google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID,
            scope: SCOPES,
            callback: (response) => {
                if (response.access_token) {
                    accessToken = response.access_token;
                    document.getElementById("status").innerText = "âœ… ÄÃ£ Ä‘Äƒng nháº­p Google Fit!";
                } else {
                    document.getElementById("status").innerText = "âŒ ÄÄƒng nháº­p tháº¥t báº¡i!";
                }
            }
        }).requestAccessToken();
    }

    document.getElementById("loginBtn").addEventListener("click", loginGoogle);

    function fakeSteps() {
        if (!accessToken) return alert("âš ï¸ Vui lÃ²ng Ä‘Äƒng nháº­p trÆ°á»›c!");

        const steps = parseInt(document.getElementById("stepsInput").value) || 10000;
        const currentTimeMillis = Date.now();
        const oneHourMillis = 60 * 60 * 1000;
        
        const requestBody = {
            "dataSourceId": "derived:com.google.step_count.delta:com.google.android.gms:estimated_steps",
            "maxEndTimeNs": (currentTimeMillis * 1e6).toString(),
            "minStartTimeNs": ((currentTimeMillis - oneHourMillis) * 1e6).toString(),
            "point": [{
                "dataTypeName": "com.google.step_count.delta",
                "startTimeNanos": ((currentTimeMillis - oneHourMillis) * 1e6).toString(),
                "endTimeNanos": (currentTimeMillis * 1e6).toString(),
                "value": [{ "intVal": steps }]
            }]
        };

        fetch("https://www.googleapis.com/fitness/v1/users/me/dataSources/derived:com.google.step_count.delta:com.google.android.gms:estimated_steps/datasets", {
            method: "PATCH",
            headers: {
                "Authorization": `Bearer ${accessToken}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify(requestBody)
        })
        .then(response => response.json())
        .then(data => {
            console.log("Ghi bÆ°á»›c chÃ¢n:", data);
            document.getElementById("status").innerText = "âœ… Ghi bÆ°á»›c chÃ¢n thÃ nh cÃ´ng!";
        })
        .catch(error => {
            console.error("Lá»—i:", error);
            document.getElementById("status").innerText = "âŒ Lá»—i ghi dá»¯ liá»‡u!";
        });
    }

    function checkSteps() {
        if (!accessToken) return alert("âš ï¸ Vui lÃ²ng Ä‘Äƒng nháº­p trÆ°á»›c!");

        const startTimeMillis = Date.now() - (24 * 60 * 60 * 1000);
        const endTimeMillis = Date.now();

        fetch("https://www.googleapis.com/fitness/v1/users/me/dataset:aggregate", {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${accessToken}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                "aggregateBy": [{
                    "dataTypeName": "com.google.step_count.delta",
                    "dataSourceId": "derived:com.google.step_count.delta:com.google.android.gms:estimated_steps"
                }],
                "bucketByTime": { "durationMillis": 86400000 },
                "startTimeMillis": startTimeMillis,
                "endTimeMillis": endTimeMillis
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log("Kiá»ƒm tra bÆ°á»›c chÃ¢n:", data);

            let steps = 0;
            if (data.bucket) {
                data.bucket.forEach(bucket => {
                    bucket.dataset.forEach(dataset => {
                        dataset.point.forEach(point => {
                            if (point.value && point.value.length > 0) {
                                steps += point.value[0].intVal || 0;
                            }
                        });
                    });
                });
            }

            document.getElementById("status").innerText = `ğŸ“Š Tá»•ng bÆ°á»›c chÃ¢n: ${steps}`;
        })
        .catch(error => {
            console.error("Lá»—i kiá»ƒm tra:", error);
            document.getElementById("status").innerText = "âŒ Lá»—i khi kiá»ƒm tra!";
        });
    }
</script>

</body>
</html>