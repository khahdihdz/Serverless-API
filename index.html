<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hack B∆∞·ªõc Ch√¢n Google Fit</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="styles.css" rel="stylesheet">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <div class="container text-center mt-5">
        <h1>üöÄ Hack B∆∞·ªõc Ch√¢n Google Fit</h1>
        <p id="status" class="text-warning">Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
        <div id="g-signin2"></div>
        <button id="signout-btn" class="btn btn-danger mt-2" disabled>ƒêƒÉng xu·∫•t</button>
        
        <div class="mt-3">
            <label for="steps" class="form-label">Ch·ªçn s·ªë b∆∞·ªõc ch√¢n:</label>
            <input type="number" id="steps" class="form-control w-50 mx-auto" min="1" value="999999">
        </div>

        <button id="hack-btn" class="btn btn-success mt-2" disabled>Th√™m B∆∞·ªõc Ch√¢n</button>
        <button id="check-btn" class="btn btn-info mt-2" disabled>Ki·ªÉm Tra D·ªØ Li·ªáu</button>
    </div>

    <script>
        const CLIENT_ID = "YOUR_CLIENT_ID";  // Thay th·∫ø b·∫±ng Client ID c·ªßa b·∫°n
        const SCOPES = "https://www.googleapis.com/auth/fitness.activity.write https://www.googleapis.com/auth/fitness.activity.read";
        let accessToken = null;

        function handleClientLoad() {
            google.accounts.id.initialize({
                client_id: CLIENT_ID,
                callback: handleCredentialResponse,
                scope: SCOPES
            });
            google.accounts.id.prompt(); // Hi·ªÉn th·ªã h·ªôp tho·∫°i ch·ªçn t√†i kho·∫£n
        }

        function handleCredentialResponse(response) {
            accessToken = response.credential;
            document.getElementById("status").innerText = "‚úÖ ƒê√£ ƒëƒÉng nh·∫≠p!";
            document.getElementById("status").classList.replace("text-warning", "text-success");
            document.getElementById("hack-btn").disabled = false;
            document.getElementById("check-btn").disabled = false;
            document.getElementById("signout-btn").disabled = false;
            console.log("Access Token:", accessToken);
        }

        function handleSignOut() {
            google.accounts.id.disableAutoSelect();
            accessToken = null;
            document.getElementById("status").innerText = "‚ùå ƒê√£ ƒëƒÉng xu·∫•t!";
            document.getElementById("status").classList.replace("text-success", "text-warning");
            document.getElementById("hack-btn").disabled = true;
            document.getElementById("check-btn").disabled = true;
        }

        function sendFakeSteps() {
            if (!accessToken) {
                alert("‚ö†Ô∏è Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc!");
                return;
            }

            let stepsCount = parseInt(document.getElementById("steps").value);
            if (stepsCount <= 0) {
                alert("‚ö†Ô∏è S·ªë b∆∞·ªõc ch√¢n ph·∫£i l·ªõn h∆°n 0!");
                return;
            }

            const startTimeMillis = new Date().getTime() - 60000; // 1 ph√∫t tr∆∞·ªõc
            const endTimeMillis = new Date().getTime(); // Hi·ªán t·∫°i
            const dataSourceId = "derived:com.google.step_count.delta:com.google.android.gms:estimated_steps";

            const requestBody = {
                "dataSourceId": dataSourceId,
                "maxEndTimeNs": endTimeMillis * 1000000,
                "minStartTimeNs": startTimeMillis * 1000000,
                "point": [{
                    "dataTypeName": "com.google.step_count.delta",
                    "startTimeNanos": startTimeMillis * 1000000,
                    "endTimeNanos": endTimeMillis * 1000000,
                    "value": [{ "intVal": stepsCount }]
                }]
            };

            fetch(`https://www.googleapis.com/fitness/v1/users/me/dataSources/${dataSourceId}/datasets/${startTimeMillis}-${endTimeMillis}`, {
                method: "PATCH",
                headers: {
                    "Authorization": `Bearer ${accessToken}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(requestBody)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById("status").innerText = `üéâ ƒê√£ th√™m ${stepsCount} b∆∞·ªõc ch√¢n!`;
                document.getElementById("status").classList.replace("text-success", "text-primary");
                console.log("Th√™m b∆∞·ªõc ch√¢n th√†nh c√¥ng:", data);
            })
            .catch(error => {
                document.getElementById("status").innerText = "‚ùå L·ªói khi g·ª≠i d·ªØ li·ªáu!";
                document.getElementById("status").classList.replace("text-primary", "text-danger");
                console.error("L·ªói khi g·ª≠i d·ªØ li·ªáu:", error);
            });
        }

        function checkSteps() {
            if (!accessToken) {
                alert("‚ö†Ô∏è Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc!");
                return;
            }

            const startTimeMillis = new Date().getTime() - (24 * 60 * 60 * 1000); // 24 gi·ªù tr∆∞·ªõc
            const endTimeMillis = new Date().getTime(); // Hi·ªán t·∫°i

            fetch(`https://www.googleapis.com/fitness/v1/users/me/dataset:aggregate`, {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${accessToken}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "aggregateBy": [{
                        "dataTypeName": "com.google.step_count.delta",
                        "dataSourceId": "derived:com.google.step_count.delta:com.google.android.gms:estimated_steps"
                    }],
                    "bucketByTime": { "durationMillis": 86400000 },
                    "startTimeMillis": startTimeMillis,
                    "endTimeMillis": endTimeMillis
                })
            })
            .then(response => response.json())
            .then(data => {
                let steps = 0;
                if (data.bucket.length > 0 && data.bucket[0].dataset.length > 0) {
                    let points = data.bucket[0].dataset[0].point;
                    if (points.length > 0) {
                        steps = points[0].value[0].intVal;
                    }
                }

                document.getElementById("status").innerText = `üìä T·ªïng b∆∞·ªõc ch√¢n h√¥m nay: ${steps}`;
                document.getElementById("status").classList.replace("text-primary", "text-info");
                console.log("D·ªØ li·ªáu ƒë√£ ghi:", data);
            })
            .catch(error => {
                document.getElementById("status").innerText = "‚ùå L·ªói khi ki·ªÉm tra d·ªØ li·ªáu!";
                document.getElementById("status").classList.replace("text-info", "text-danger");
                console.error("L·ªói khi ki·ªÉm tra d·ªØ li·ªáu:", error);
            });
        }

        document.getElementById("signout-btn").addEventListener("click", handleSignOut);
        document.getElementById("hack-btn").addEventListener("click", sendFakeSteps);
        document.getElementById("check-btn").addEventListener("click", checkSteps);
        window.onload = handleClientLoad;
    </script>
</body>
</html>